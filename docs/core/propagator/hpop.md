# 高精度轨道预报器

## 概述

高精度轨道预报器 (High Precision Orbit Propagator, HPOP) 是基于数值积分的高精度轨道预报系统，采用模块化设计思想，支持多种摄动力模型的精确模拟。该系统参考Simulink的仿真思想，将复杂的轨道动力学系统分解为多个功能模块的组合。

## 核心概念

### 模块化设计

参考Simulink的仿真思想，HPOP采用函数块(Function Block)架构，将轨道动力学系统分解为多个功能模块的组合。
每个函数块可以是普通函数块或导数函数块，负责计算系统的一个子问题，例如计算动力学系统中一个或多个状态量或者其导数。
不同函数块之间通过输入输出端口进行信号连接，组合得到一个动力学系统。


主要特点包括：

- **功能模块化**：将复杂系统分解为多个独立的功能模块
- **数据共享**：通过函数块之间的信号连接实现数据共享，减少重复计算
- **灵活组合**：可灵活组合不同函数块，形成定制化的仿真模型

### 力模型配置

HPOP支持多种摄动力模型的精确模拟：

- **中心天体重力场**：可配置阶数和次数的球谐函数模型
- **大气阻力**：考虑大气密度变化的阻力模型
- **太阳辐射压**：太阳光压对航天器的影响
- **三体引力**：月球、太阳等第三体引力摄动
- **相对论效应**：相对论修正

## 主要接口

### 类接口

```cpp
class AST_CORE_API HPOP
```

**主要方法：**

```cpp
// 设置力模型
err_t setForceModel(const HPOPForceModel& forcemodel);

// 设置积分器
void setIntegrator(ODEIntegrator* integrator);

// 轨道预报
err_t propagate(const TimePoint& start, const TimePoint& end, Vector3d& position, Vector3d& velocity);

// 初始化
err_t initialize();
```

### 力模型配置结构

```cpp
struct HPOPForceModel
{
    bool useDrag_{false};                    // 是否使用阻力模型
    bool useSRP_{false};                     // 是否使用太阳辐射压模型
    bool useMoonGravity_{false};             // 是否使用月球引力
    Gravity gravity_;                        // 中心天体重力场配置
    // ... 其他力模型配置
};
```

## 用法示例

### 1. 基本轨道预报

@[code](/examples/propagator/hpop/basic_propagation.cpp)

### 2. 高级力模型配置

@[code](/examples/propagator/hpop/advanced_force_model.cpp)

### 3. 多天轨道预报

@[code](/examples/propagator/hpop/multi_day_propagation.cpp)

## 系统架构

### 仿真引擎

HPOP基于一个类似Simulink的仿真引擎实现：

- **时间管理**：统一的仿真时间步进控制
- **数据流管理**：模块间数据传递和共享机制
- **积分器接口**：支持多种数值积分算法

### 功能模块分类

#### 天文模块 (BlockAstro)

- 二体动力学、引力场计算、相对论效应等

#### 通用模块 (BlockCommon)

- 数学运算、逻辑操作、信号路由等

#### 输入输出模块

- 数据源、数据接收、文件输出等

## 精度与性能

### 精度特点

- **最高精度**：数值积分方法，可达到较高精度
- **全面摄动**：支持所有主要摄动力模型的精确模拟
- **可配置性**：可根据任务需求调整精度和计算复杂度

### 性能考虑

- **计算开销**：相比解析方法，计算量较大
- **内存使用**：需要存储中间状态和力模型数据
- **实时性**：适合离线高精度轨道预报，实时应用需优化

## 配置指南

### 力模型选择

根据任务需求选择合适的力模型：

- **近地轨道**：重力场(高阶)+大气阻力+月球引力
- **中高轨道**：重力场(低阶)+太阳光压+三体引力
- **深空轨道**：精密星历+太阳光压+相对论效应

### 积分器选择

- RKF78等变步长积分器
- RK4、RK8等定步长积分器

## 注意事项

- 初始化前必须正确配置力模型和积分器
- 长时间预报需要考虑力模型参数的时效性
- 高精度计算需要相应的星历和地球定向参数支持
- 内存和计算资源需求随模型复杂度增加

## 优势与局限

### 优势

1. 模块化设计便于维护和调试
2. 支持复杂摄动力模型的精确模拟
3. 可灵活组合满足不同任务需求
4. 提供统一的误差控制和精度管理

### 局限

1. 架构复杂，需要考虑模块依赖关系
2. 数据流管理需要精心设计
3. 计算资源需求较高
4. 实时应用需要性能优化

## API参考

@[code](/src/AstCore/Propagator/HPOP/HPOP.hpp)