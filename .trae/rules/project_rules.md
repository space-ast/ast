# ast项目编码规则

## 1. 项目概述
- **项目名称**：ast（Aerospace Simulation Algorithm Library）
- **项目类型**：C++航天仿真算法库
- **主要功能**：提供航天动力学、数学运算、优化算法等核心功能
- **构建系统**：xmake

## 2. 目录结构规则

### 2.1 顶层目录结构
- `src/`：源代码目录，按模块组织
- `include/`：公共头文件目录，包含转发头文件
- `test/`：测试代码目录
- `examples/`：示例代码目录
- `projects/`：项目示例目录
- `docs/`：文档目录
- `data/`：数据文件目录
- `thirdparty/`：第三方库目录
- `.trae/`：TREA配置目录
- `.github/`：GitHub配置目录，包含工作流、ISSUE_TEMPLATE等文件
- `xmake.lua`：项目构建配置文件

### 2.2 模块目录结构
每个模块应遵循以下结构：
```
ModuleName/
├── README.md          # 模块说明文档
├── FunctionDir1/      # 功能子目录1，包含相关的.hpp和.cpp文件
├── FunctionDir2/      # 功能子目录2，包含相关的.hpp和.cpp文件
├── ...                # 其他功能子目录
├── xmake.lua          # 模块构建配置
```

**说明：**
- 功能子目录下直接包含相关的头文件(.hpp)和源文件(.cpp)
- 模块下没有单独的include/和src/目录，头文件和源文件按功能组织在子目录中
- 模块根目录下放置模块级别的配置文件`xmake.lua`和说明文件`README.md`
- 每个模块生成相应的转发头文件，放在`include/ModuleName/`目录下
- 代码里头文件的引用路径应该从`include/`目录开始，引用里面的转发头文件

## 3. 编码规范

### 3.1 命名约定
- **命名空间**：使用`AST_NAMESPACE_BEGIN`和`AST_NAMESPACE_END`包裹代码
- **类名**：使用大驼峰命名法，如`Object`、`Class`
- **函数名**：使用小驼峰命名法，如`getAttrBool`、`setAttrInt`
- **变量名**：使用小驼峰命名法，如`type`、`refcnt`
- **常量名**：使用`k`前缀，如`kEarthGrav`
- **宏定义**：使用全大写加下划线，如`AST_UTIL_API`

### 3.2 注释规范
- 使用Doxygen风格注释
- 为类、函数、变量添加适当的注释
- 头文件中添加版权信息和许可证声明
- 函数注释应包含参数说明、返回值说明和功能描述

### 3.3 文件头模板
所有头文件和源文件应包含以下文件头：
```cpp
///
/// @file      文件名
/// @brief     文件简要说明
/// @details   文件详细说明
/// @author    作者名
/// @date      日期
/// @copyright 版权所有 (C) 2025-present, ast项目.
///
/// ast项目（https://github.com/space-ast/ast）
/// 本项目基于 Apache 2.0 开源许可证分发。
/// 您可在遵守许可证条款的前提下使用、修改和分发本软件。
/// 许可证全文请见：
/// 
///    http://www.apache.org/licenses/LICENSE-2.0
/// 
/// 重要须知：
/// 软件按“现有状态”提供，无任何明示或暗示的担保条件。
/// 除非法律要求或书面同意，作者与贡献者不承担任何责任。
/// 使用本软件所产生的风险，需由您自行承担。
```

## 4. 模块开发规则

### 4.1 核心模块
以下模块为核心模块，需仔细设计和开发：
- **AstUtil**：工具函数模块
- **AstCore**：动力学核心模块
- **AstMath**：数学运算模块
- **AstOpt**：优化算法接口模块
- **AstOCP**：最优控制问题求解模块

### 4.2 AI辅助开发模块
以下模块可通过AI辅助开发：
- **AstScript**：脚本系统
- **AstInterp**：交互式控制台
- **AstMex**：MATLAB封装
- **AstPy**：Python封装
- **AstWasm**：Web Assembly封装
- **AstGfx**：可视化
- **AstGui**：图形化界面

### 4.3 模块间依赖
- 低层级模块（如AstUtil）不应依赖高层级模块
- 模块间依赖应通过头文件声明，避免循环依赖
- 使用前向声明减少头文件包含

## 5. 构建规则

### 5.1 xmake配置
- 项目使用xmake作为构建系统
- 主构建配置在根目录的`xmake.lua`
- 每个模块有自己的`xmake.lua`配置

### 5.2 语言标准
- C++标准：C++11
- C标准：C99
- 不要使用过高的C++标准，以确保对C++11的兼容性

### 5.3 第三方依赖
- 第三方库应放在根目录的`thirdparty/`目录
- 每个第三方库有自己独立的子目录，保留其原始目录结构
- 使用xmake的`add_requires`和`add_packages`管理依赖
- 对于无法通过包管理器获取的库，直接将源码放入`thirdparty/`目录
- 第三方库的构建配置在`thirdparty/xmake.lua`中管理

## 6. 测试规则

### 6.1 测试框架
- 使用Google Test（gtest）进行单元测试
- 测试代码集中放在根目录的`test/`目录下
- 按模块名称组织子目录，如`test/Core/`, `test/Util/`等
- 若某个源文件的功能较集中，可创建对应的测试文件，测试文件名在源文件名基础上添加`test`前缀
- 单元测试文件名格式：`testXXX.cpp`
- 性能测试文件名格式：`bmXXX.cpp`（benchmark）


### 6.2 测试运行

- 所有测试：使用`xmake test`运行所有测试
- 单元测试：使用`xmake test */unittest`运行所有单元测试
- 性能测试：使用`xmake test */benchmark`运行所有性能测试
- 示例测试：使用`xmake test */example`运行所有示例测试
- 单个测试：使用`xmake r 测试目标名`运行指定的测试目标

上面的命令加上`-v`可以查看详细输出，例如`xmake test -v unittest/*`


### 6.3 测试覆盖率

- 核心模块测试覆盖率应不低于90%
- 主要通过单元测试和示例测试来确保覆盖率

## 7. 文档规则

### 7.1 文档格式
- 使用Markdown格式编写文档
- 模块README应包含：
  - 模块概述
  - 核心功能
  - 使用示例
  - 注意事项

### 7.2 API文档
- 使用Doxygen生成API文档
- 文档应包含：
  - 类和函数说明
  - 参数和返回值说明
  - 示例代码

## 8. 版本控制规则

### 8.1 Git规范
- 使用Git进行版本控制
- 遵循语义化版本规范
- 提交信息应清晰描述变更内容

### 8.2 分支管理
- `master`：主分支，保持稳定
- `dev`：开发分支，整合各功能分支
- `feature/*`：功能分支，开发新功能
- `bugfix/*`：修复分支，修复bug

## 9. 许可证规则

- 项目采用Apache 2.0许可证
- 所有代码文件必须包含许可证声明
- 第三方库必须符合其各自的许可证要求

## 10. 注意事项

- 代码应具有跨平台兼容性
- 避免使用平台特定的API，如需使用应提供封装
- 性能敏感部分应进行优化和基准测试
- 遵循C++11标准，确保代码兼容性
- 定期运行测试确保代码质量
- 及时更新文档，保持与代码同步
- 及时处理代码中的警告和错误

